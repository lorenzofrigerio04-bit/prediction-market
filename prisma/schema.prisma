// Schema Prisma per Prediction Market
// NOTA: Se hai già uno schema Prisma completo altrove, aggiungi solo il model Notification
// e la relazione notifications Notification[] al tuo model User esistente

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Model User base - Se hai già un model User, aggiungi solo la relazione notifications Notification[]
model User {
  id            String    @id @default(cuid())
  email         String?   @unique
  name          String?
  emailVerified DateTime?
  image         String?
  streakCount   Int       @default(0)
  credits       Int       @default(100)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relazione con Notification
  notifications Notification[]

  // Aggiungi qui altre relazioni se esistono (predictions, events, etc.)
  // predictions Prediction[]
  // events Event[]
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  type      String   // EVENT_CLOSING_SOON | EVENT_RESOLVED | RANK_UP | STREAK_RISK
  data      String?  // Dati aggiuntivi in formato JSON (es: { eventId, eventTitle, oldRank, newRank, etc })
  readAt    DateTime?
  createdAt DateTime @default(now())

  // Relazione con User
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, readAt])
  @@index([createdAt])
}

model AuditLog {
  id         String    @id @default(cuid())
  userId     String?   // Null se azione di sistema
  action     String    // Es: EVENT_CREATE, EVENT_RESOLVE, COMMENT_HIDE, etc.
  entityType String    // Es: "event", "comment", "user", etc.
  entityId   String?   // ID dell'entità su cui è stata eseguita l'azione
  payload    String?   // Dati aggiuntivi in formato JSON
  createdAt  DateTime  @default(now())

  @@index([userId])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@index([action])
}
